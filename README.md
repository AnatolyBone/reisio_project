## Финансовый помощник для грузоперевозчиков

Mini App для Telegram: ввод данных остается в боте, приложение показывает визуализацию, историю и сводки.

## Основные возможности

- Главная: приветствие, KPI (доходы/расходы/прибыль/остаток), напоминания
- Финансовая сводка: графики доходов/расходов, структура расходов, фильтры периода
- История заказов: таблица с сортировкой, поиском, пагинацией
- Расходы и заправки: фильтры по типам, график расхода топлива, список расходов
- Лизинг и платежи: календарь платежей, статусы, список предстоящих оплат
- Настройки: тема, уведомления через бота, период отчетности

## Технологии

- React + Vite + Tailwind CSS
- Recharts для графиков

## Запуск

1. `npm install`
2. `npm run dev`

## Переменные окружения

- `VITE_TELEGRAM_BOT_USERNAME` — имя Telegram-бота для перехода из WebApp.
- `DATABASE_URL` — строка подключения Postgres.
- `TELEGRAM_BOT_TOKEN` — токен бота для проверки Telegram OAuth.
- `JWT_SECRET` — секрет для JWT.
- `VITE_API_BASE` — базовый путь API (по умолчанию `/api`).
- `ALLOW_MANUAL_LOGIN` — разрешить вход по Telegram ID (для теста).
- `WEBAPP_URL` — URL Mini App для кнопки в боте.
- `ADMIN_TELEGRAM_ID` — Telegram ID администратора для уведомлений.

## Бэкенд (Netlify Functions + Postgres)

- API размещается в `netlify/functions` и доступно через `/api/*` (redirect в `netlify.toml`).
- Prisma schema: `prisma/schema.prisma`, миграции: `prisma/migrations`.
- Поддержка: тикеты создаются пользователем и видны в админке.

## Netlify деплой

1. Подключить репозиторий в Netlify.
2. Добавить переменные окружения из `.env.example`.
3. Build command: `npm run build`, Publish directory: `dist`.

## Структура

```
src/
  components/   UI-компоненты
  pages/        Страницы приложения
  context/      Контекст темы и настроек
  data/         Мок-данные для UI
  utils/        Вспомогательные функции
```

## Примечания

- Данные хранятся в Postgres (Supabase) и доступны и боту, и Mini App.
- Авторизация: Telegram WebApp (авто-вход) или тестовый вход по Telegram ID.
- Веб-админка доступна для администратора (ID по умолчанию: `2018254756`).

## Первый запуск для пользователя

- На главном экране есть кнопка "Помощь" с краткой инструкцией.
- Если данных нет, появится блок "Начните с первого шага".

## Бот (MVP)

Минимальная философия: бот = вход, Mini App = основное.

Команды:

- `/start` — краткая инструкция, регистрация, выбор 1/несколько машин, кнопка «Открыть приложение».
- `/app` — открыть Mini App.
- `/добавить` — меню кнопками: рейс, заправка, платёж, расход.
- `/отчёт` — доход за период, расходы, прибыль, ближайший платёж.
- `/напоминания` — список обязательств + «Отметить оплачено».
- `/помощь` — короткая справка, что всё в приложении.

## Бот (интеграция с БД)

Функция бота находится в `netlify/functions/bot.js` и принимает webhook от Telegram.

1. В Telegram выставить webhook:
   - `https://api.telegram.org/bot<ТОКЕН>/setWebhook?url=https://<YOUR_NETLIFY>/api/bot`
2. Бот сохраняет расходы/рейсы сразу в Postgres через Prisma.
3. Состояние диалога хранится в БД (`User.botState`), поэтому работает в Netlify Functions.
4. При тикетах поддержки админ получает уведомление в Telegram.
